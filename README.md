# High-performance Communicating Architecture #
# 高性能通信架构 #

## 综述 ##
 本项目实现了高性能接入层服务器，从
   消息吞吐量(30万 TPS)、     并发时延(250us)、
   客户端连接速率(1万/秒)、   最大连接数(不受限)
 四方面，提供性能测试数据指标。

## 性能测试数据 ##
1) 测试环境：
 Win7 PC安装的Linux虚拟机：X64 RedHat 7.5[3.10.0-862.el7.x86_64]
 CPU: Intel i3-3220 3.30GHz[4核]
 虚拟机内存: 4GB
 fd句柄限制数：100,000
 socket缓冲区大小：core.wmem_max = core.rmem_max = 10485760
 部署方式：客户端、服务端同机部署

2) 测试基准：
 消息长度: 总长1024字节，包头长度16字节。  
 消息处理方式：校验包头、计数再转发。
 
 
3) 测试吞吐量[throughput]：~ 30万(300,000) TPS。
 发包方式：每秒发送指定个数。
 消息路径：[client -> server -> client]
  一个往返后消息释放，记一次；统计每2百万(2,000,000)次的收包间隔。

 场景1) 1个socket连接，每秒发送 300,000个包;
 测试结果：间隔基本维持在8秒以下。
 计算吞吐量: 约为发送速率，30万(300,000) TPS
   a) 客户端/服务端 程序内存均维持在600MB左右，cpu均维持在130%左右。

 场景2) 2万(20,000)个socket连接，每个连接每秒发送15个包;
 测试结果：间隔基本维持在8秒以下。
 计算吞吐量：约为30万 TPS
   a) 客户端/服务端 程序内存均维持在800MB左右，cpu维持在180%左右。

4) 测试最小时延：~230微妙
 消息路径：一个往返记一次，消息继续循环。
 
 场景1) 1个socket客户端，初始发送1个消息包，统计客户端每10万(100,000)次的收包间隔
  测试结果：间隔基本维持在23秒以下。
  计算时延数据：~ 23s / 100,000 = 230 us
  
 场景2) 1个socket客户端，初始发送1000个消息包，统计每2百万(2,000,000)次的收包间隔
  测试结果：间隔基本维持在 15 秒以下。
 
 场景3) 1000个socket客户端，每客户端初始发送1个消息包，统计每2百万(2,000,000)次的收包间隔
  测试结果：间隔基本维持在 60 秒以下。
  
5) 客户端连接速率：~ 1万/秒
  环境：net.core.somaxconn = net.ipv4.tcp_max_syn_backlog = 10000
  场景：客户端并发启动2万(20,000)个连接，统计完成时间。
  测试结果：在1.5秒内全部连接，开始收发包。
  a) 采用异步connect模式。

6) 服务端最大连接数：仅受限于 系统连接数 
  a) 每个socket占用 不超过400 字节。
  b) socket队列/链表使用自身内存 。
 
## 结束语 ##   
 The End: No pain, No gain. Show me the Performance!!  
 
 
                               
